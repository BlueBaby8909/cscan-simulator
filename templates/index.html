<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C-SCAN Scheduler | OS Project</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
</head>
<body>

<div class="container">
    <header>
        <h1>C-SCAN Disk Scheduler</h1>
        <div class="subtitle">Performance Innovative Task: Client-Server Model</div>
    </header>

    {% if error %} <div class="error-msg">{{ error }}</div> {% endif %}

    <form method="POST">
        <div class="input-grid">
            <div class="form-group full-width">
                <label>Request Queue</label>
                <input type="text" name="queue" value="{{ form.queue }}" required>
            </div>

            <div class="form-group">
                <label>Head Start</label>
                <input type="number" name="head" value="{{ form.head }}" required>
            </div>
            <div class="form-group">
                <label>Disk Size</label>
                <input type="number" name="size" value="{{ form.size }}" required>
            </div>

            <div class="form-group full-width">
                <label>Seek Direction</label>
                <div class="segmented-control">
                    <input type="radio" id="dir_pos" name="direction" value="1"
                           {% if form.direction == '1' %}checked{% endif %}>
                    <label for="dir_pos">Ascending (+)</label>

                    <input type="radio" id="dir_neg" name="direction" value="0"
                           {% if form.direction == '0' %}checked{% endif %}>
                    <label for="dir_neg">Descending (-)</label>
                </div>
            </div>
        </div>

        <button type="submit" class="btn-submit">Simulate Algorithm</button>
    </form>

    {% if result %}
    <div class="stats-row">
        <div class="stat-card">
            <div class="stat-value">{{ result.seek_time }}</div>
            <div class="stat-label">Total Seek Time</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ result.sequence | length }}</div>
            <div class="stat-label">Total Steps</div>
        </div>
    </div>

    <div class="form-group">
        <label>Traversal Sequence</label>
        <div class="sequence-box">{{ result.sequence | join(' â†’ ') }}</div>
    </div>

    <div style="margin-top: 40px;">
        <label style="color: var(--text-secondary); font-size: 0.85rem; font-weight: 600; margin-bottom: 10px; display: block;">VISUALIZATION</label>
        <div class="chart-container">
            <canvas id="diskGraph"></canvas>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>

    <script>
        // Pass server-side data to the client-side script
        const sequenceData = {{ result.sequence | tojson }};
        const diskLimit = {{ result.disk_size }};

        // Call function from script.js
        initChart(sequenceData, diskLimit);
    </script>
    {% endif %}
</div>

</body>
</html>